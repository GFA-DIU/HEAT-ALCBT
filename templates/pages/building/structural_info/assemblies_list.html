<script src="https://unpkg.com/htmx.org@1.9.12"></script>
{% load custom_filters %}
{% if structural_components %}
<h6 class="mt-2">Components/materials added</h6>
{% endif %}
<ul class="list-group">
    {% for component in structural_components %}
    <li class="list-group-item d-flex justify-content-between align-items-center position-relative">
        <!-- Component name and main content -->
        <div class="col-6">
            <h5 class="mb-1">{{ component.assembly_name }}</h5>
            <div class="d-flex flex-column">
                {%if not component.is_boq%}
                <span class="text-muted ms-1">{{ component.assembly_classification }}</span>
                <span class="text-muted ms-1">Quantity: {{ component.quantity|floatformat:"-2" }}{{ component.unit|superscript_units|safe }}</span>{%else%}
                <span class="text-muted ms-1">Bill of quantities (BoQ)</span>
                {%endif%}
            </div>
        </div>

        <!-- Emissions (centered) -->
        <div class="col-3 d-flex justify-content-center align-items-center">
            <span class="badge border border-success text-success bg-transparent rounded-pill" style="font-size: medium;" title='{{ component.impacts|floatformat:"-6" }}kg CO₂eq/m²'> Carbon: {{ component.impacts|floatformat:"-2" }}kg CO₂eq/m²</span>
        </div>
        <!-- Action Buttons -->
        <div class="col-3 d-flex justify-content-end align-items-center gap-2">
            {% if component.is_boq%}
            <a href="{% url 'boq_edit' assembly_id=component.assembly_id building_id=building_id %}?simulation={{simulation}}" class="btn btn-secondary">Edit</a>
            {%else%}
            <a href="{% url 'component_edit' assembly_id=component.assembly_id building_id=building_id %}?simulation={{simulation}}" class="btn btn-secondary">Edit</a>
            {% endif%}

            <button class="btn btn-danger"
                    {% if simulation %} hx-delete="{% url 'building_simulation' building_id=building_id %}?component={{ component.assembly_id }}"
                    {% else %} hx-delete="{% url 'building' building_id=building_id %}?component={{ component.assembly_id }}" {% endif %}
                    hx-target="#item-list"
                    hx-swap="innerHTML"
                    >
                Delete
            </button>
        </div>
    </li>
    {% endfor %}
</ul>

<!-- Pagination -->
<div class="mt-3">
    <nav aria-label="Pagination">
        <ul class="pagination justify-content-center">
            <!-- Jump to First Button -->
            {% if structural_components.has_previous %}
            <li class="page-item">
                <a class="page-link" style="cursor: pointer"
                   {% if simulation %}
                   hx-get="{% url 'building_simulation' building_id=building_id %}?page=1&component_page=true&simulation={{ simulation }}"
                   {% else %}
                   hx-get="{% url 'building' building_id=building_id %}?page=1&component_page=true&simulation={{ simulation }}"
                   {% endif %}
                   hx-target="#item-list"
                   hx-swap="innerHTML"
                   aria-label="First">
                    <span aria-hidden="true">Start</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link" aria-hidden="true">Start</span>
            </li>
            {% endif %}

            <!-- Previous Button -->
            {% if structural_components.has_previous %}
            <li class="page-item">
                <a class="page-link" style="cursor: pointer"
                   {% if simulation %}
                   hx-get="{% url 'building_simulation' building_id=building_id %}?page={{ structural_components.previous_page_number }}&component_page=true&simulation={{ simulation }}"
                   {% else %}
                   hx-get="{% url 'building' building_id=building_id %}?page={{ structural_components.previous_page_number }}&component_page=true&simulation={{ simulation }}"
                   {% endif %}
                   hx-target="#item-list"
                   hx-swap="innerHTML"
                   aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link" aria-hidden="true">&laquo;</span>
            </li>
            {% endif %}

            <!-- Page Numbers -->
            {% for num in structural_components.paginator.page_range %}
                {% if num >= structural_components.number|add:-2 and num <= structural_components.number|add:2 %}
                <li class="page-item {% if num == structural_components.number %}active{% endif %}">
                    <a class="page-link" style="cursor: pointer"
                       {% if simulation %}
                       hx-get="{% url 'building_simulation' building_id=building_id %}?page={{ num }}&component_page=true&simulation={{ simulation }}"
                       {% else %}
                       hx-get="{% url 'building' building_id=building_id %}?page={{ num }}&component_page=true&simulation={{ simulation }}"
                       {% endif %}
                       hx-target="#item-list"
                       hx-swap="innerHTML">{{ num }}</a>
                </li>
                {% endif %}
            {% endfor %}

            <!-- Next Button -->
            {% if structural_components.has_next %}
            <li class="page-item">
                <a class="page-link" style="cursor: pointer"
                   {% if simulation %}
                   hx-get="{% url 'building_simulation' building_id=building_id %}?page={{ structural_components.next_page_number }}&component_page=true&simulation={{ simulation }}"
                   {% else %}
                   hx-get="{% url 'building' building_id=building_id %}?page={{ structural_components.next_page_number }}&component_page=true&simulation={{ simulation }}"
                   {% endif %}
                   hx-target="#item-list"
                   hx-swap="innerHTML"
                   aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link" aria-hidden="true">&raquo;</span>
            </li>
            {% endif %}

            <!-- Jump to Last Button -->
            {% if structural_components.has_next %}
            <li class="page-item">
                <a class="page-link" style="cursor: pointer"
                   {% if simulation %}
                   hx-get="{% url 'building_simulation' building_id=building_id %}?page={{ structural_components.paginator.num_pages }}&component_page=true&simulation={{ simulation }}"
                   {% else %}
                   hx-get="{% url 'building' building_id=building_id %}?page={{ structural_components.paginator.num_pages }}&component_page=true&simulation={{ simulation }}"
                   {% endif %}
                   hx-target="#item-list"
                   hx-swap="innerHTML"
                   aria-label="Last">
                    <span aria-hidden="true">End</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link" aria-hidden="true">End</span>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>

<script>
    document.body.addEventListener('componentDeleted', function() {
      console.log('Server told us deletion finished');
      htmx.trigger('#assembly_dashboard', 'refresh');
      htmx.trigger('#material_dashboard', 'refresh');
    });
  </script>